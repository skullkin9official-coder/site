<!DOCTYPE html>
<html lang="en-US">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>3RROR5TUDIOS</title>
  <link rel="icon" type="image/png" href="images/3RROR5TUDIOS.png">

<style>
* { box-sizing: border-box; margin:0; padding:0; }

body {
  font-family: 'Arial', sans-serif;
  background: linear-gradient(135deg, #40006e, #8100b4);
  color: white;
  min-height: 100vh;
  padding: 20px;
}

/* HEADER */
header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 50px;
}

.logo-container img { width: 50px; height: 50px; }
nav ul { display: flex; list-style: none; gap: 50px; }
nav ul li { display: flex; align-items: center; }

/* TOPBAR */
.topbar {
  width: 100%;
  padding: 12px 15px;
  background: rgba(0,0,0,0.3);
  border-radius: 12px;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.topbar-left {
  display: flex;
  align-items: center;
  gap: 20px;
}

.nav-link { color: white; text-decoration: none; font-size: 14px; }
.nav-link:hover { color: #ffdd00; }

.topbar-right { display: flex; align-items: center; gap: 12px; }

.login-btn {
  background:#c300ff; 
  padding:8px 14px; 
  border-radius:6px; 
  font-weight:bold; 
  border:none; 
  cursor:pointer;
}

/* PROFILE AREA */
.profile-area {
  display: flex;
  align-items: center;
  gap: 8px;
  cursor: pointer;
}

.pfp {
  width: 32px; height: 32px;
  border-radius: 50%;
  border: 2px solid #ffdd00;
}

/* DROPDOWN */
.dropdown {
  position: absolute;
  top: 70px;
  right: 25px;
  background: rgba(0,0,0,0.7);
  border-radius: 10px;
  padding: 10px;
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.dropdown button {
  background:#c300ff; 
  border:none;
  border-radius:6px;
  padding:8px;
  cursor:pointer;
  color:white;
}

.hidden { display:none !important; }

/* CARD */
.card {
  background: rgba(0,0,0,0.4);
  padding: 20px;
  border-radius: 12px;
  max-width: 500px;
  margin: 30px auto;
}

/* INVENTORY */
.grid { 
  display: grid; 
  grid-template-columns: repeat(auto-fill, minmax(180px,1fr)); 
  gap: 20px; 
}

.tile {
  background: rgba(255,255,255,0.1);
  padding: 10px;
  border-radius: 10px;
  text-align:center;
}

.tile img { width: 100%; border-radius: 10px; }

/* PROFILE CUSTOMIZER */
#profileCustomizer {
  background: rgba(0,0,0,0.3);
  max-width: 500px;
  margin: 20px auto;
  padding: 15px;
  border-radius: 12px;
  display: none;
}

#profileCustomizer img {
  width: 64px; height: 64px; border-radius: 50%; margin:auto;
}
</style>
</head>

<body>

<header>
  <div class="logo-container">
    <a href="index.html"><img src="images/3RROR5TUDIOS.png"></a>
    <h1>Home</h1>
  </div>
  <nav>
    <ul>
      <li><a href="Games.html"><img src="images/controll.png" width="30"><p style="font-size:10px;">GAMES</p></a></li>
      <li><a href="ERRORVERSE.html"><img src="images/ERRORVERSE.png" width="30"><p style="font-size:10px;">ERRORVERSE</p></a></li>
    </ul>
  </nav>
</header>

<!-- TOP BAR -->
<nav class="topbar">
  <div class="topbar-left">
    <div class="logo">ERRORVERSE</div>
    <a class="nav-link" href="#games">Games</a>
    <a class="nav-link" href="#errorverse">Errorverse</a>
  </div>

  <div class="topbar-right">
    <button id="topLoginBtn" class="login-btn">Login</button>

    <div id="profileArea" class="profile-area hidden">
      <img id="navbarPFP" class="pfp" src="images/default_avatar.png">
      <span id="navbarName">Guest</span>
    </div>

    <div id="profileDropdown" class="dropdown hidden">
      <button id="openCustomizer">Customize Profile</button>
      <button id="logoutBtn">Logout</button>
    </div>
  </div>
</nav>

<!-- LOGIN CARD -->
<div class="card" id="loginCard">
  <h2>Login / Register</h2>
  <label>Email</label>
  <input id="email" placeholder="you@example.com">
  <label>Password</label>
  <input type="password" id="password" placeholder="min 6 chars">
  <button id="loginBtnMain">Login</button>
  <button id="registerBtn">Register</button>
  <p id="status"></p>
</div>

<!-- PROFILE CUSTOMIZER -->
<div id="profileCustomizer">
  <h3>Customize Profile</h3>
  <img id="customAvatar" src="images/default_avatar.png">
  <label>Username:</label>
  <input type="text" id="customUsername">
  <label>Avatar URL:</label>
  <input type="text" id="customAvatarURL">
  <button id="saveProfile">Save Changes</button>
</div>

<!-- INVENTORY -->
<div class="card" id="inventoryCard" style="display:none;">
  <h2>Your Inventory</h2>
  <button id="refreshInv">Refresh Inventory</button>
  <div class="grid" id="inventoryGrid"></div>
</div>

<!-- PLAYFAB -->
<script>
var PlayFab={settings:{titleId:"1FC26D"},_internalSettings:{sessionTicket:null}};

var PlayFabClientAPI={
  LoginWithEmailAddress:(req,success,error)=>{
    req.TitleId=PlayFab.settings.titleId;
    fetch("https://1FC26D.playfabapi.com/Client/LoginWithEmailAddress",{
      method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(req)
    }).then(r=>r.json()).then(x=>x.data?success(x):error(x));
  },
  RegisterPlayFabUser:(req,success,error)=>{
    req.TitleId=PlayFab.settings.titleId;
    fetch("https://1FC26D.playfabapi.com/Client/RegisterPlayFabUser",{
      method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(req)
    }).then(r=>r.json()).then(x=>x.data?success(x):error(x));
  },
  GetUserInventory:(req,success,error)=>{
    fetch("https://1FC26D.playfabapi.com/Client/GetUserInventory",{
      method:"POST",
      headers:{
        "Content-Type":"application/json",
        "X-Authorization":PlayFab._internalSettings.sessionTicket
      },
      body:"{}"
    }).then(r=>r.json()).then(x=>x.data?success(x):error(x));
  }
};
</script>

<!-- TOPBAR LOGIC -->
<script>
const topLoginBtn=document.getElementById("topLoginBtn");
const profileArea=document.getElementById("profileArea");
const navbarPFP=document.getElementById("navbarPFP");
const navbarName=document.getElementById("navbarName");
const profileDropdown=document.getElementById("profileDropdown");
const openCustomizer=document.getElementById("openCustomizer");
const logoutBtn=document.getElementById("logoutBtn");

function updateTopbarProfile(name,avatar="images/default_avatar.png"){
  navbarName.textContent=name;
  navbarPFP.src=avatar;
  topLoginBtn.classList.add("hidden");
  profileArea.classList.remove("hidden");
}

function resetTopbar(){
  profileDropdown.classList.add("hidden");
  profileArea.classList.add("hidden");
  topLoginBtn.classList.remove("hidden");
}

navbarPFP.onclick=()=>profileDropdown.classList.toggle("hidden");

openCustomizer.onclick=()=>{
  profileDropdown.classList.add("hidden");
  document.getElementById("profileCustomizer").style.display="block";
};

logoutBtn.onclick=()=>{
  localStorage.clear();
  resetTopbar();
  location.reload();
};

(function(){
  const name=localStorage.getItem("CUSTOM_USERNAME");
  const avatar=localStorage.getItem("CUSTOM_AVATAR");
  const pfid=localStorage.getItem("PLAYFAB_PLAYFABID");
  if(pfid){ updateTopbarProfile(name||pfid,avatar||"images/default_avatar.png"); }
})();
</script>

<!-- MAIN LOGIN / INVENTORY LOGIC -->
<script>
const emailEl=document.getElementById("email");
const passwordEl=document.getElementById("password");
const statusEl=document.getElementById("status");
const loginBtn=document.getElementById("loginBtnMain");
const registerBtn=document.getElementById("registerBtn");
const loginCard=document.getElementById("loginCard");
const inventoryCard=document.getElementById("inventoryCard");
const inventoryGrid=document.getElementById("inventoryGrid");
const refreshBtn=document.getElementById("refreshInv");

// Profile customizer
const profileCustomizer=document.getElementById("profileCustomizer");
const customUsername=document.getElementById("customUsername");
const customAvatar=document.getElementById("customAvatar");
const customAvatarURL=document.getElementById("customAvatarURL");
const saveProfile=document.getElementById("saveProfile");

function setStatus(msg,color="yellow"){
  statusEl.style.color=color;
  statusEl.textContent=msg;
}

function saveSession(res){
  const d=res.data;
  localStorage.setItem("PLAYFAB_PLAYFABID",d.PlayFabId);
  localStorage.setItem("PLAYFAB_SESSIONTICKET",d.SessionTicket);
  PlayFab._internalSettings.sessionTicket=d.SessionTicket;

  updateTopbarProfile(d.PlayFabId);
  setStatus("Logged in!");

  loginCard.style.display="none";
  inventoryCard.style.display="block";
}

loginBtn.onclick=()=>{
  const email=emailEl.value.trim();
  const pw=passwordEl.value.trim();
  if(!email||pw.length<6){ setStatus("Invalid email/password","red"); return; }

  setStatus("Logging in...");
  PlayFabClientAPI.LoginWithEmailAddress(
    {Email:email,Password:pw},
    saveSession,
    err=>setStatus(err.errorMessage||"Login failed","red")
  );
};

registerBtn.onclick=()=>{
  const email=emailEl.value.trim();
  const pw=passwordEl.value.trim();
  if(!email||pw.length<6){ setStatus("Invalid email/password","red"); return; }

  setStatus("Registering...");
  PlayFabClientAPI.RegisterPlayFabUser(
    {Email:email,Password:pw,RequireBothUsernameAndEmail:false},
    saveSession,
    err=>setStatus(err.errorMessage||"Error","red")
  );
};

function fetchInventory(){
  inventoryGrid.innerHTML="Loading...";
  PlayFabClientAPI.GetUserInventory({},res=>{
    const items=res.data.Inventory||[];
    inventoryGrid.innerHTML="";
    if(items.length===0){ inventoryGrid.innerHTML="No items."; return; }

    items.forEach(i=>{
      inventoryGrid.innerHTML+=`
        <div class="tile">
          <img src="images/wsx.png">
          <h3>${i.DisplayName||i.ItemId}</h3>
          <p>Uses: ${i.RemainingUses||"â€”"}</p>
        </div>`;
    });
  });
}

refreshBtn.onclick=fetchInventory;

// Save custom profile
saveProfile.onclick=()=>{
  const name=customUsername.value.trim()||"User";
  const avatar=customAvatarURL.value.trim()||"images/default_avatar.png";

  navbarName.textContent=name;
  navbarPFP.src=avatar;
  customAvatar.src=avatar;

  localStorage.setItem("CUSTOM_USERNAME",name);
  localStorage.setItem("CUSTOM_AVATAR",avatar);

  setStatus("Profile updated!","#ffdd00");
};

// Auto session
(function(){
  const pfid=localStorage.getItem("PLAYFAB_PLAYFABID");
  const name=localStorage.getItem("CUSTOM_USERNAME");
  const avatar=localStorage.getItem("CUSTOM_AVATAR");
  if(pfid){
    updateTopbarProfile(name||pfid,avatar||"images/default_avatar.png");
    loginCard.style.display="none";
    inventoryCard.style.display="block";
    fetchInventory();
  }
})();
</script>

</body>
</html>
